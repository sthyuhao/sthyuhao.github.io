<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>集成Hikari问题汇总 | 余额不足</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="lldb_codesign no identity found，___isOSVersionAtLeast">
<meta name="keywords" content="LLVM">
<meta property="og:type" content="article">
<meta property="og:title" content="集成Hikari问题汇总">
<meta property="og:url" content="http://yoursite.com/2018/12/21/2018-12-21/index.html">
<meta property="og:site_name" content="余额不足">
<meta property="og:description" content="lldb_codesign no identity found，___isOSVersionAtLeast">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://raw.githubusercontent.com/sthyuhao/BlogImgZone/master/77d0b794a9a38339c7d9eff92e990e.jpg">
<meta property="og:updated_time" content="2018-12-26T04:39:55.979Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="集成Hikari问题汇总">
<meta name="twitter:description" content="lldb_codesign no identity found，___isOSVersionAtLeast">
<meta name="twitter:image" content="https://raw.githubusercontent.com/sthyuhao/BlogImgZone/master/77d0b794a9a38339c7d9eff92e990e.jpg">
  
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">余额不足</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-2018-12-21" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/12/21/2018-12-21/" class="article-date">
  <time datetime="2018-12-21T03:30:10.000Z" itemprop="datePublished">2018-12-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/混淆/">混淆</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      集成Hikari问题汇总
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>此文记录了编译Hikari混淆器所遇到的问题，希望对有同样问题的你有些帮助，也写给未来遇到问题的自己。</p>
<h2 id="lldb-codesign-no-identity-found"><a href="#lldb-codesign-no-identity-found" class="headerlink" title="lldb_codesign no identity found"></a>lldb_codesign no identity found</h2><p>准备在项目中引入Hikari混淆器，Xcode9编译成功后并且能正常运行，但最近苹果修复了Xcode10打包iOS9Crash的问题后我也就把macOS升级到了mojave，Xcode也升级到了10，问题也就来了，之前的Hikari ToolChain也没法用了，怎么办？重装呗！</p>
<p>重新执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone -b release_70 --recursive https://github.com/HikariObfuscator/Hikari.git Hikari &amp;&amp; mkdir Build &amp;&amp; cd Build &amp;&amp; cmake -G &quot;Ninja&quot; -DCMAKE_BUILD_TYPE=MinSizeRel -DLLVM_APPEND_VC_REV=on -DLLVM_CREATE_XCODE_TOOLCHAIN=on -DCMAKE_INSTALL_PREFIX=~/Library/Developer/ ../Hikari &amp;&amp; ninja &amp;&amp;ninja install-xcode-toolchain &amp;&amp; git clone https://github.com/HikariObfuscator/Resources.git ~/Hikari &amp;&amp; rsync -a --ignore-existing /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/ ~/Library/Developer/Toolchains/Hikari.xctoolchain/ &amp;&amp; rm ~/Library/Developer/Toolchains/Hikari.xctoolchain/ToolchainInfo.plist</span><br></pre></td></tr></table></figure>
<p>困扰了我两天的问题来了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[4399/4695] Linking CXX executable bin/debugserver</span><br><span class="line">FAILED: bin/debugserver</span><br><span class="line">: &amp;&amp; /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/c++  -fPIC -fvisibility-inlines-hidden -Werror=date-time -Werror=unguarded-availability-new -std=c++11 -Wall -Wextra -Wno-unused-parameter -Wwrite-strings -Wcast-qual -Wmissing-field-initializers -pedantic -Wno-long-long -Wcovered-switch-default -Wnon-virtual-dtor -Wdelete-non-virtual-dtor -Wstring-conversion -fdiagnostics-color -Wno-deprecated-declarations -Wno-unknown-pragmas -Wno-strict-aliasing -Wno-deprecated-register -Wno-vla-extension -Wno-gnu-zero-variadic-macro-arguments -Wno-zero-length-array -Wno-extended-offsetof -Os -DNDEBUG -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.14.sdk -Wl,-search_paths_first -Wl,-headerpad_max_install_names -stdlib=libc++ -Wl,-sectcreate,__TEXT,__info_plist,/Users/yuhao/HikariObfuscator/Hikari/tools/lldb/tools/debugserver/source/../resources/lldb-debugserver-Info.plist    -Wl,-dead_strip tools/lldb/tools/debugserver/source/CMakeFiles/debugserver.dir/debugserver.cpp.o  -o bin/debugserver  -Wl,-rpath,@loader_path/../lib lib/liblldbDebugserverCommon.a -framework Cocoa -framework CoreFoundation -framework Foundation lib/liblldbDebugserverArchSupport.a lib/liblldbDebugserverDarwin_DarwinLog.a -lcompression &amp;&amp; cd /Users/yuhao/HikariObfuscator/Build/bin &amp;&amp; /usr/local/Cellar/cmake/3.13.2/bin/cmake -E env CODESIGN_ALLOCATE=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/codesign_allocate codesign --force --sign lldb_codesign --entitlements /Users/yuhao/HikariObfuscator/Hikari/tools/lldb/tools/debugserver/source/../../../resources/debugserver-macosx-entitlements.plist /Users/yuhao/HikariObfuscator/Build/bin/debugserver</span><br><span class="line">lldb_codesign: no identity found</span><br></pre></td></tr></table></figure>
<p>最初碰到问题时觉得是执行debugserver出问题了，也没有仔细查看问题就直接去google了，然而看了一遍遍的文章，一篇篇别的LLVM项目的issue也能解决问题。后来觉得会不会是debugserver在mojave和Xcode10上是不是有什么问题？然后找到了一个<a href="https://github.com/derekparker/delve/issues/1398" target="_blank" rel="noopener">issue</a>，这里表示需要安装完整的Xcode command line tools，随后执行了<code>xcode-select --install</code>，执行完再次编译Hikari，依然出现同样的错误。</p>
<p>看看Hikari的issue吧，也许会遇到同样错误的同学，果不其然<a href="https://github.com/HikariObfuscator/Hikari/issues/24" target="_blank" rel="noopener">Linking CXX executable bin/debugserver failed</a>。<br>这个issue也同样遇到了<code>Linking CXX executable bin/debugserver
FAILED</code>的问题，但看了下内容，好像并不一样，zhang总的回答是<code>Just remove lldb from tools/lldb, it&#39;s too much troublesome to setup on macOS</code>，于是跟着照做，再次编译。WTF，两小时过去后依然卡在同一个位置。</p>
<h2 id="找到问题的根本原因"><a href="#找到问题的根本原因" class="headerlink" title="找到问题的根本原因"></a>找到问题的根本原因</h2><p>仔细分析错误日志，日志的最后提到了<code>lldb_codesign: no identity found</code>，再次google，搜到的回答有说需要check一下<code>lldb_codesign</code>的<code>certificate</code>，我也是哔了狗了，最终的解决方案就是添加一个<code>lldb_codesign</code>证书，信任就行了，具体执行请参照<a href="https://opensource.apple.com/source/lldb/lldb-69/docs/code-signing.txt" target="_blank" rel="noopener">这里</a>。</p>
<p>到这，Hikari编译加配置是成功了，更换了Xcode的ToolChain，build一哈，一个新的问题又来了<br><code>clang: error: cannot specify -o when generating multiple output files</code><br><img src="https://raw.githubusercontent.com/sthyuhao/BlogImgZone/master/77d0b794a9a38339c7d9eff92e990e.jpg" alt><br>如上图所示，将图中的配置项置成NO即可，再次Build，Perfect！</p>
<h2 id="Undefined-symbols-isOSVersionAtLeast"><a href="#Undefined-symbols-isOSVersionAtLeast" class="headerlink" title="Undefined symbols ___isOSVersionAtLeast"></a>Undefined symbols ___isOSVersionAtLeast</h2><p>上面的配置让我们在demo中可以完美编译，但是拉到我们的项目中又出了个<a href="https://github.com/HikariObfuscator/Hikari/issues/56" target="_blank" rel="noopener">幺蛾子</a>，zhang总在issue中的回答是需要显示的链接<code>clang-rt</code>,从<code>Hikari.xctoolchain/usr/lib/clang/10.0.0/lib/darwin</code>找到<code>libclang_rt.ios.a</code>，简单粗暴的办法就是直接拖进主工程，并且在<code>Build Phases</code>选项卡下的<code>Link Binary With Libraries</code>下引入<code>libclang_rt.ios.a</code>。</p>
<h2 id="Pods库不能使用？"><a href="#Pods库不能使用？" class="headerlink" title="Pods库不能使用？"></a>Pods库不能使用？</h2><p>由于我们的项目使用了Pods管理组件模块，仅仅在主工程配置build Settings并不能影响到Pods中的代码，如果直接在Pods的proj文件中修改只会在本地文件生效，而别人拉下来重新pod install之后配置项又变成了空的。</p>
<h3 id="怎么解决？"><a href="#怎么解决？" class="headerlink" title="怎么解决？"></a>怎么解决？</h3><p>目前有两种方案，一种是在podfile写<code>post_install</code>脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">post_install do |installer|</span><br><span class="line">    installer.pods_project.targets.each do |target|</span><br><span class="line">        target.build_configurations.each do |config|</span><br><span class="line">            if target.name == &apos;target名称&apos; #对指定的库进行混淆</span><br><span class="line">                config.build_settings[&apos;OTHER_CFLAGS&apos;] = &apos;-mllvm -enable-allobf&apos;</span><br><span class="line">            end</span><br><span class="line">            config.build_settings[&apos;COMPILER_INDEX_STORE_ENABLE&apos;] = &apos;NO&apos;</span><br><span class="line">        end</span><br><span class="line">    end</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<p>这种方案比较灵活，指哪打哪。</p>
<p>另一种方案，在<code>podsepc</code>文件中修改配置项</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s.pod_target_xcconfig = &#123;</span><br><span class="line">    &apos;OTHER_CFLAGS&apos; =&gt; &apos;-mllvm -enable-allobf&apos;,</span><br><span class="line">    &apos;COMPILER_INDEX_STORE_ENABLE&apos; =&gt; &apos;NO&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方案稍显笨重，如果需要修改还需要对库重新打包。<br>如果有需要推荐第一种方案。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2018/12/21/2018-12-21/" data-id="cju0wbqjm0001tmum00n6ma97" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LLVM/">LLVM</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/02/13/2019-02-13/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          年初的一些感慨
        
      </div>
    </a>
  
  
    <a href="/2018/11/12/2018-11-12/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">解析__block</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    <!-- Featured Tags -->

  
    <!-- Short About -->
<section class="visible-md visible-lg">
    <h5><a href="/about/">ABOUT ME</a></h5>
    <div class="short-about">

        

        

        <!-- SNS Link -->
        <ul class="list-inline">
            
            
            

            

            

            
            
            
            
        </ul>
    </div>
</section>
  
    
  <h5>RECENT POSTS
  <div class="widget">
    <ul>
      
        <li>
          <a href="/2019/03/20/2019-03-20/">扒一扒Category以及关联对象</a>
        </li>
      
        <li>
          <a href="/2019/02/13/2019-02-13/">年初的一些感慨</a>
        </li>
      
        <li>
          <a href="/2018/12/21/2018-12-21/">集成Hikari问题汇总</a>
        </li>
      
        <li>
          <a href="/2018/11/12/2018-11-12/">解析__block</a>
        </li>
      
        <li>
          <a href="/2018/11/01/2018-10-31/">从源码分析Block的内存管理</a>
        </li>
      
    </ul>
  </div>
</h5>
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Category/">Category</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/LLVM/">LLVM</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/block/">block</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/优化/">优化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/内存管理/">内存管理</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/混淆/">混淆</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/逆向/">逆向</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/随笔杂谈/">随笔杂谈</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 余果<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js"></script>

  </div>
</body>
</html>